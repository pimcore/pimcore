# Upgrading Pimcore from Version 6.x to Version 10

## System Requirements
 - PHP >= 8.0
 - Apache >= 2.4

## Database
- MariaDB >= 10.3
- MySQL >= 8.0
- Percona Server (supported versions see MySQL)

## Preparatory Work
- If you're on a version between 6.0.0 and 6.8.x, then please update to 6.9.x first and then continue with the upgrade steps.

## IMPORTANT CHANGES PRIOR THE UPDATE!

### Migrating legacy module/controller/action configurations to new controller references
You can use `./bin/console migration:controller-reference` to migrate your existing Documents, Static routes and Document Types to the new controller references in the format: `AppBundle\Controller\FooController::barAction`.

### Cleanup your composer.json
Update composer.json as per [skeleton](https://github.com/pimcore/skeleton/blob/master/composer.json)

### Update folder structure 
Update your project folder structure as per [Symfony Flex](https://symfony.com/doc/current/setup/flex.html) guidelines. See demo changes [here](https://github.com/pimcore/demo/pull/203/files)

Important changes:
- Move configs from app/config/*.yml to config/*.yaml
- Move templates from app/Resources/views to templates and bundles templates from 
- Move app/AppKernel.php to src/App/Kernel.php
- Rename web/ to public/ & web/app.php to public/index.php

### Add .env environment file
Add [.env](https://github.com/pimcore/skeleton/blob/master/.env) file to project root, if not exists already.

### Migrate Php templates to Twig
Since Pimcore X supports only Symfony 5, which dropped the support for Php templates, it is required to update your php templates to Twig. 

If you are using enterprise edition, then it is still possible to support Php templates by installing `pimcore/php-templating-engine-bundle`.

### Adapt System settings
Due to change in Pimcore config that no extra keys are allowed under pimcore node anymore, it is required to adapt system settings as per [system.template.yml](https://github.com/pimcore/demo/blob/master/var/config/system.template.yml) & [config.yaml](https://github.com/pimcore/demo/blob/master/config/config.yaml)

points to consider:
 - Removed `swiftmailer` config 
 - `cache` key renamed to `full_page_cache`
 - Removed webservice config

### Flush your `/tmp` directories
```bash
rm -r var/tmp
rm -r web/var/tmp
```

### Flush your recycle-bin
Migrating the items in the recycle-bin is not supported.
To have a clear start with Pimcore 10 we recommend to flush it before migration.
```bash
rm -r var/recyclebin
```

```sql
TRUNCATE TABLE recyclebin;
```

### Move user images
The default location of the user images has changed, simply move the contents over to the new location: 
```bash
mkdir var/admin
mv var/user-images var/admin/user-images
```

### Update your `.htaccess` or your Nginx configuration
- Updated `.htaccess` is available [here](https://github.com/pimcore/skeleton/blob/master/public/.htaccess). 
- Updated Nginx configuration is available [here](../03_System_Setup_and_Hosting/02_Nginx_Configuration.md). 
